<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 2 - Using Jaeger | Distributed Tracing Workshop</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/distributed-tracing-workshop/favicon.ico">
    <meta name="description" content="Distributed Tracing Workshop">
    <meta property="og:site_name" content="Distributed Tracing Workshop">
    <meta property="og:title" content="Lab 2 - Using Jaeger">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://alvsanand.github.io/distributed-tracing-workshop/laboratory-02/">
    <meta property="og:image" content="https://alvsanand.github.io/distributed-tracing-workshop/img/distributed-tracing_practice_preview.png">
    <meta name="twitter:title" content="Lab 2 - Using Jaeger">
    <meta name="twitter:url" content="https://alvsanand.github.io/distributed-tracing-workshop/laboratory-02/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://alvsanand.github.io/distributed-tracing-workshop/img/distributed-tracing_practice_preview.png">
    
    <link rel="preload" href="/distributed-tracing-workshop/assets/css/0.styles.a19eab89.css" as="style"><link rel="preload" href="/distributed-tracing-workshop/assets/js/app.6775e0d1.js" as="script"><link rel="preload" href="/distributed-tracing-workshop/assets/js/2.c94d9c33.js" as="script"><link rel="preload" href="/distributed-tracing-workshop/assets/js/3.8ef80796.js" as="script"><link rel="preload" href="/distributed-tracing-workshop/assets/js/10.2d3ec1a6.js" as="script"><link rel="prefetch" href="/distributed-tracing-workshop/assets/js/11.41c785af.js"><link rel="prefetch" href="/distributed-tracing-workshop/assets/js/12.c4f0c58b.js"><link rel="prefetch" href="/distributed-tracing-workshop/assets/js/13.6cf10b4b.js"><link rel="prefetch" href="/distributed-tracing-workshop/assets/js/4.9a78ff1b.js"><link rel="prefetch" href="/distributed-tracing-workshop/assets/js/5.3cf7cc20.js"><link rel="prefetch" href="/distributed-tracing-workshop/assets/js/6.b08bc6e7.js"><link rel="prefetch" href="/distributed-tracing-workshop/assets/js/7.cf86b5a0.js"><link rel="prefetch" href="/distributed-tracing-workshop/assets/js/8.ba6d7404.js"><link rel="prefetch" href="/distributed-tracing-workshop/assets/js/9.424d0cce.js">
    <link rel="stylesheet" href="/distributed-tracing-workshop/assets/css/0.styles.a19eab89.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/distributed-tracing-workshop/" class="home-link router-link-active"><img src="/distributed-tracing-workshop/img/distributed-tracing_practice.png" alt="Distributed Tracing Workshop" class="logo"> <span class="site-name can-hide">Distributed Tracing Workshop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/distributed-tracing-workshop/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="@alvsanand" class="dropdown-title"><span class="title">@alvsanand</span> <span class="arrow down"></span></button> <button type="button" aria-label="@alvsanand" class="mobile-dropdown-title"><span class="title">@alvsanand</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/alvsanand" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.linkedin.com/in/alvsanand/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinekdIn
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://bluetab.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bluetab
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Links" class="dropdown-title"><span class="title">Links</span> <span class="arrow down"></span></button> <button type="button" aria-label="Links" class="mobile-dropdown-title"><span class="title">Links</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://opentracing.io/docs/overview/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OpenTracing
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.jaegertracing.io/docs/latest" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Jaeger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/distributed-tracing-workshop/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="@alvsanand" class="dropdown-title"><span class="title">@alvsanand</span> <span class="arrow down"></span></button> <button type="button" aria-label="@alvsanand" class="mobile-dropdown-title"><span class="title">@alvsanand</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/alvsanand" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.linkedin.com/in/alvsanand/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinekdIn
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://bluetab.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bluetab
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Links" class="dropdown-title"><span class="title">Links</span> <span class="arrow down"></span></button> <button type="button" aria-label="Links" class="mobile-dropdown-title"><span class="title">Links</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://opentracing.io/docs/overview/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OpenTracing
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.jaegertracing.io/docs/latest" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Jaeger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/distributed-tracing-workshop/" aria-current="page" class="sidebar-link">Distributed Tracing Workshop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/#goals" class="sidebar-link">Goals</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/#index" class="sidebar-link">Index</a></li></ul></li><li><a href="/distributed-tracing-workshop/technical_overview/" class="sidebar-link">Technical Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/technical_overview/#what-is-distributed-tracing" class="sidebar-link">What is Distributed Tracing?</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/technical_overview/#why-should-we-use-it" class="sidebar-link">Why should we use it?</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/technical_overview/#opentracing" class="sidebar-link">OpenTracing</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/technical_overview/#jaeger" class="sidebar-link">Jaeger</a></li></ul></li><li><a href="/distributed-tracing-workshop/laboratory-01/" class="sidebar-link">Lab 1 - Installing Jaeger</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-01/#_1-installing-minikube" class="sidebar-link">1. Installing Minikube</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-01/#_2-starting-the-cluster" class="sidebar-link">2. Starting the cluster</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-01/#_3-interacting-with-k8s" class="sidebar-link">3. Interacting with K8s</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-01/#_4-deploying-a-sample-application" class="sidebar-link">4. Deploying a sample application</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-01/#_5-deleting-minikube-cluster" class="sidebar-link">5. Deleting minikube cluster</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-01/#_6-deploying-jaeger-operator" class="sidebar-link">6. Deploying Jaeger Operator</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-01/#_7-deploying-jaeger-instance" class="sidebar-link">7. Deploying Jaeger instance</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-01/#_8-validating-jaeger-deployment" class="sidebar-link">8. Validating Jaeger deployment</a></li></ul></li><li><a href="/distributed-tracing-workshop/laboratory-02/" aria-current="page" class="active sidebar-link">Lab 2 - Using Jaeger</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-02/#_1-installing-hotrod" class="sidebar-link">1. Installing HotROD</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-02/#_2-using-hotrod" class="sidebar-link">2. Using HotROD</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-02/#_3-understanding-the-data-flow-of-an-application" class="sidebar-link">3. Understanding the Data Flow of an application</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-02/#_4-searching-the-source-of-a-bottleneck" class="sidebar-link">4. Searching the source of a bottleneck</a></li></ul></li><li><a href="/distributed-tracing-workshop/laboratory-03/" class="sidebar-link">Lab 3 - Integrating an app</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-03/#_1-install-the-application-as-is-in-k8s" class="sidebar-link">1. Install the application as is in K8s</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-03/#_2-integrating-flask-app-with-jaeger" class="sidebar-link">2. Integrating flask-app with Jaeger</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-03/#_3-integrating-sinatra-app-with-jaeger" class="sidebar-link">3. Integrating sinatra-app with Jaeger</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-03/#_4-propagating-the-tracing-http-headers" class="sidebar-link">4. Propagating the tracing HTTP headers</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-03/#_5-adding-children-spans" class="sidebar-link">5. Adding children spans</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-03/#_6-installing-modified-version-of-the-application-in-k8s" class="sidebar-link">6. Installing modified version of the application in k8s</a></li><li class="sidebar-sub-header"><a href="/distributed-tracing-workshop/laboratory-03/#_7-testing-the-application" class="sidebar-link">7. Testing the application</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="lab-2-using-jaeger"><a href="#lab-2-using-jaeger" class="header-anchor">#</a> Lab 2 - Using Jaeger</h1> <p>In the second laboratory of the workshop, we will install <a href="https://github.com/jaegertracing/jaeger/tree/master/examples/hotrod" target="_blank" rel="noopener noreferrer">HotROD (Rides on Demand)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a demo application that consists of several microservices and illustrates the use of the OpenTracing API. Afterwards, we will review most of the Jaeger features.</p> <p>We will perform the following tasks:</p> <ol><li>Install HotROD in K8s.</li> <li>Use the Jaeger UI</li> <li>Obtain the data flow of an application.</li> <li>Searching the source of a bottleneck using Jaeger.</li></ol> <h2 id="_1-installing-hotrod"><a href="#_1-installing-hotrod" class="header-anchor">#</a> 1. Installing HotROD</h2> <ol><li><p>Install HotROD:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>kubectl create namespace hotrod

<span class="token assign-left variable">K8S_INGRESS_IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get -n observability ingress -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'{.items[0].status.loadBalancer.ingress[0].ip}'</span><span class="token variable">)</span></span>

kubectl apply -f - <span class="token operator">&lt;&lt;</span><span class="token string">EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: app
    app.kubernetes.io/instance: hotrod
  name: hotrod-app
  namespace: hotrod
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: app
      app.kubernetes.io/instance: hotrod
      app.kubernetes.io/name: hotrod-app
  template:
    metadata:
      labels:
        app.kubernetes.io/component: app
        app.kubernetes.io/instance: hotrod
        app.kubernetes.io/name: hotrod-app
    spec:
      containers:
      - env:
        - name: JAEGER_AGENT_HOST
          value: jaeger-workshop-agent.observability.svc.cluster.local
        - name: JAEGER_AGENT_PORT
          value: &quot;6831&quot;
        image: jaegertracing/example-hotrod:latest
        imagePullPolicy: Always
        args: [&quot;all&quot;, &quot;-j&quot;, &quot;http://<span class="token variable">$K8S_INGRESS_IP</span>&quot;]
        livenessProbe:
          httpGet:
            path: /
            port: 8080
        name: jaeger-hotrod
        ports:
        - containerPort: 8080
        readinessProbe:
          httpGet:
            path: /
            port: 8080
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/component: service
    app.kubernetes.io/instance: hotrod
  name: hotrod-service
  namespace: hotrod
spec:
  selector:
    app.kubernetes.io/component: app
    app.kubernetes.io/instance: hotrod
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
EOF</span></code></pre></div></li> <li><p>Enable port forwarding:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>kubectl port-forward -n hotrod service/hotrod-service <span class="token number">8080</span>:8080
</code></pre></div></li> <li><p>Access HotROD, the application is available at <a href="http://localhost:8080/" target="_blank" rel="noopener noreferrer">http://localhost:8080/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ol> <h2 id="_2-using-hotrod"><a href="#_2-using-hotrod" class="header-anchor">#</a> 2. Using HotROD</h2> <p>HotROD is a very simple &quot;ride sharing&quot; application.</p> <p>In the home page we have four customers, and by clicking one of the four buttons we send a car to arrive to the customer’s location. Therefore a request for a car is sent to the backend, it responds with the car’s license plate number and the expected time of arrival:</p> <p>There are a few bits of debugging information we see on the screen.</p> <p><img src="/distributed-tracing-workshop/assets/img/hotrod-ui.d75cd382.png" alt="Hotrod UI"></p> <ol><li>In the top left corner there is a <code>web client id: 9323</code>. It is a random session ID assigned by Javascript UI; if we reload the page we get a different session ID.</li> <li>In the line about the car we see a request ID <code>req: 9323-1</code>. It is a unique ID assigned by Javascript UI to each request it makes to the backend, composed of the session ID and a sequence number.</li> <li>The last bit of debugging data, <code>latency: 782ms</code>, is measured by the Javascript UI and shows how long the backend took to respond.</li> <li>This additional information has no impact on the behavior of the application, but will be useful when we look under the hood.</li></ol> <h3 id="architecture"><a href="#architecture" class="header-anchor">#</a> Architecture</h3> <p><img src="/distributed-tracing-workshop/assets/img/hotrod-architecture.48aea768.png" alt="Hotrod Architecture"></p> <p>Hotrod is a very simple application composed of 6 microservices:</p> <ul><li>1 frontend microservices.</li> <li>3 backend microservices which are called by the frontend.</li> <li>2 storage backends.</li></ul> <p>The storage nodes are not actually real, they are simulated by the app as internal components, but the top four microservices are indeed real.</p> <h2 id="_3-understanding-the-data-flow-of-an-application"><a href="#_3-understanding-the-data-flow-of-an-application" class="header-anchor">#</a> 3. Understanding the Data Flow of an application</h2> <p>One of the main advantages of Distributed Tracing is that we are able to track a request through a software system that is distributed across multiple applications, services, and databases as well as intermediaries like proxies.</p> <p>So, let’s find out the data flow of HotROD.</p> <ol><li>Access HotROD (<a href="http://localhost:8080/" target="_blank" rel="noopener noreferrer">http://localhost:8080/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) and click several times in some of the customers.
<img src="/distributed-tracing-workshop/assets/img/hotrod-ui.d75cd382.png" alt="Hotrod UI"></li> <li>Go to the <strong>Search</strong> page in the <strong>Jaeger UI</strong>.</li> <li>Select <code>frontend</code> in the <strong>Service</strong> drop-down list because is our root service and <code>HTTP GET /dispatch</code> in the <strong>Operation</strong> drop-down list to filter the dispatch action.</li> <li>Click <strong>Find Traces</strong>.
<img src="/distributed-tracing-workshop/assets/img/frontend-traces.44f821b6.png" alt="Frontend traces"></li> <li>Next, click in one of the traces on the right side.
<img src="/distributed-tracing-workshop/assets/img/dispatch-trace.50494ff2.png" alt="Dispatch trace"></li></ol> <p>Now, Jaeger showS the trace of one of our request and displays some meta-data about it, such as the names of different services that participated in the trace, and the number of spans each service emitted to Jaeger.</p> <ul><li>The top level endpoint name is displayed in the title bar: <code>HTTP GET /dispatch</code>.</li> <li>On the right side we see the total duration of the trace. This is shorter than the duration we saw in the HotROD UI because the latter was measured from the Browser.</li> <li>The timeline view shows a typical view of a trace as a time sequence of nested spans, where a span represents a unit of work within a single service. The top level span, also called the <code>root</code> span, represents the main HTTP request from Javascript UI to the <code>frontend</code> service, which in turn called the <code>customer</code> service, which in turn called a <code>MySQL</code> database.</li> <li>The width of the spans is proportional to the time the operation takes. It also represent the time waiting for other services calls.</li></ul> <p>Using that information we can generate the data flow of the request:</p> <div class="mermaid">
graph TD
    B[/Browser\] --&gt; |1| F[frontend];
    F[frontend] --&gt; |2| C[customer];
    C[customer] ---&gt; |3| M[(mysql)];
    F[frontend] --&gt; |&quot;4 [gRPC]&quot;| D[driver];
    D[driver] -.-&gt; |5| Re[(redis)];
    D[driver] --&gt; |5| Re[(redis)];
    F[frontend] --&gt; |6| Ro[route];
    F[frontend] --&gt; |6| Ro[route];
    F[frontend] --&gt; |6| Ro[route];
    F[frontend] --&gt; |6| Ro[route];
    F[frontend] --&gt; |7| B[/Browser\];
</div> <ol><li>A <code>HTTP GET</code> request are sent the to <code>/dispatch</code> endpoint  of the <code>frontend</code> service.</li> <li>The <code>frontend</code> service makes a HTTP GET request to the <code>/customer</code> endpoint of the <code>customer</code> service.</li> <li>The <code>customer</code> service executes an statement in the <code>MySQL DB</code> and those results are sent to the <code>frontend</code> service.</li> <li>The <code>frontend</code> service makes a <code>gRPC</code> request <code>Driver::findNearest</code> to the driver service.</li> <li>The <code>driver</code> service makes several calls to <code>Redis</code>. Some of them are failures.</li> <li>The <code>frontend</code> service executes many of <code>HTTP GET</code> requests to the <code>/route</code> endpoint of the <code>route</code> service.</li> <li>The <code>frontend</code> service returns the result.</li></ol> <h2 id="_4-searching-the-source-of-a-bottleneck"><a href="#_4-searching-the-source-of-a-bottleneck" class="header-anchor">#</a> 4. Searching the source of a bottleneck</h2> <p>Another cool feature of Distributed Tracing is that using its information we can find easily the bottlenecks of our system. In order to do that we are going to stress the system making so many calls and using Jaeger we are going to find out the root of the problem.</p> <ol><li>Access HotROD (<a href="http://localhost:8080/" target="_blank" rel="noopener noreferrer">http://localhost:8080/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) and click multiple times on the customers until the latency goes up very sharply.
<img src="/distributed-tracing-workshop/assets/img/hotrod_latency.0ee5f98a.png" alt="HotROD latency"></li> <li>Click in the first <strong>find trace</strong> link which it will take us to see the trace of the request in Jaeger.
<img src="/distributed-tracing-workshop/assets/img/jaeger_request.06f7ad59.png" alt="Jaeger request"></li> <li>Next, click in the <code>HTTP GET /dispatch</code> request to see a detailed view of its trace through the system.
<img src="/distributed-tracing-workshop/assets/img/jaeger_trace.b5bbbeb9.png" alt="Jaeger trace"></li></ol> <p>Now, we are able to see what going on in the system:</p> <ol><li>As we mentioned before, the actual processing time is different that we saw in the HotROD web page. This is because the server is not able to handle all the request in time and it has to put them in a queue even before any span is generated.</li> <li>The trace shows that the request was handle in almost 2 seconds.</li> <li>Reviewing all the span, we can detect that the <code>customer</code> service call to <code>mysql</code> service is generating more that 70% of the processing time. This is our most promising <strong>bottleneck</strong> candidate.</li> <li>Finally, we can click in the <code>mysql</code> service call to see more information about that specific <strong>span</strong>. Thanks that the developers added a custom tag <code>sql.query</code> we can identify very easily the SQL statement that is generating the problem.
<img src="/distributed-tracing-workshop/assets/img/jaeger_mysql_span.cf5d4967.png" alt="Jaeger MySQL span"></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/distributed-tracing-workshop/laboratory-01/" class="prev">
        Lab 1 - Installing Jaeger
      </a></span> <span class="next"><a href="/distributed-tracing-workshop/laboratory-03/">
        Lab 3 - Integrating an app
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/distributed-tracing-workshop/assets/js/app.6775e0d1.js" defer></script><script src="/distributed-tracing-workshop/assets/js/2.c94d9c33.js" defer></script><script src="/distributed-tracing-workshop/assets/js/3.8ef80796.js" defer></script><script src="/distributed-tracing-workshop/assets/js/10.2d3ec1a6.js" defer></script>
  </body>
</html>
